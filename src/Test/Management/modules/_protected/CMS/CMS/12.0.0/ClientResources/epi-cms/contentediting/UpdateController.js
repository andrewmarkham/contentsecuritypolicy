//>>built
define("epi-cms/contentediting/UpdateController",["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _3(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_a){_1.mixin(this,_a);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];_1.forEach(_1.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],_1.hitch(this,function(_b){this._modelWatchHandle.push(this.contentModel.watch(_b,_1.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){_2.forEach(this._modelWatchHandle,function(_c){_c.remove();});_1.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_d){},onRender:function(_e){},_renderNode:function(_f,_10,_11){var _12=this.contentLink;var _13=this.renderSettings;var _14=this.rendererClass;var _15=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_12,_15,_11,_13,_14);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;_1.when(def,_1.hitch(this,function(_16){if(this._lastRenderDeferred){if(_16.doReload!==undefined&&_16.doReload){this.onReloadRequired(this);}else{if(_1.isString(_16)){this._updateRendering(_16);}else{if(_16.innerHtml!==undefined){this._updateRendering(_16.innerHtml,_16.attributes);}else{if(_16.error!==undefined){this._handleValidationError(_16.error);}}}}if(def===this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_17){var _18="";if(!_17){return false;}if(_17.tagName==="IMG"){_18=_1.attr(_17,"src")||"";}else{_18=_17.innerHTML;}_18=_18.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof _18=="string")&&(_18.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _19;if(!this._showEmptyNode){return;}_19=this._isEmptyHtml(this.displayNode);if(_19&&this._canModifyDisplayNode()){this.displayNode.innerHTML=_1.string.substitute(this.emptyValue,this);}this._ensureSize();},_canModifyDisplayNode:function(){return this.rendererClass!=="epi-cms/contentediting/NullRenderer";},_ensureSize:function(){if(!this._canModifyDisplayNode()){return;}try{this._clearComputedStyle();this._computeStyle();}catch(e){console.warn("Could not get or set domStyle for displayNode",e);}},_clearComputedStyle:function(){var _1a=this._originalStyle;if(_1a){for(var _1b in _1a){if(_1a.hasOwnProperty(_1b)){_6.set(this.displayNode,_1b,this._originalStyle[_1b]);}}this._originalStyle=null;}},_computeStyle:function(){var _1c=this.displayNode,_1d=_1c&&_6.get(_1c);if(!_1d){return;}var _1e={minWidth:_6.toPixelValue(_1c,_1d.minWidth),minHeight:_6.toPixelValue(_1c,_1d.minHeight),display:_1d.display},_1f={},_20=_1e.minHeight===0,_21=_1e.minWidth===0,_22=_1e.display==="inline",_23=_7.getMarginBox(_1c,_1d);if(_23.h<(_20?this.minHeight:_1e.minHeight)||_23.w<(_21?this.minWidth:_1e.minWidth)){if(_20){_1f.minHeight=this.minHeight+"px";}if(_21){_1f.minWidth=this.minWidth+"px";}if(_22){_1f.display="inline-block";}if(_22||_20||_21){this._originalStyle=_1e;_6.set(_1c,_1f);}}},_updateRendering:function(_24,_25){this.displayNode.innerHTML=_24;if(_25){_2.forEach(_25,_4.hitch(this,function(_26){this._updateAttribute(_26);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_6.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_27){if(_27.name.toLowerCase()==="class"){_5.add(this.displayNode,_27.value);}else{_8.set(this.displayNode,_27.name,_27.value);}},_handleValidationError:function(_28){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){_9.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});