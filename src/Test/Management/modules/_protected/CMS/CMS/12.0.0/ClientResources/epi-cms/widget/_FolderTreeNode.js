//>>built
require({cache:{"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\r\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>"}});define("epi-cms/widget/_FolderTreeNode",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,on,_a,_b,_c,_d,_e,_f,epi,_10){_1("_TreeInlineEditor",[_f._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});return _1([_10,_7],{templateString:_c,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_6.set(this.iconNodeMenu,"zIndex",_5.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _f({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:_2.hitch(this,this._onChangeLabelValue),onCancel:_2.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",_2.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!==_9.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_4.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,_11){if(!this.labelWidget.value){this._resetValue(val);}if(_11&&_11.length>0){this._setEditorState(_11[0].errorMessage);}},bindContextMenu:function(_12){this.contextMenu=_12;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var _13=this,def=new _8();_a(_13.inherited(arguments),function(){_13._currentRowState=_13._currentRowState^_13._rowStates.EXPANDED;_13._updateStyle();def.resolve(true);});return def;},expand:function(){var _14=this,def=new _8();_a(_14.inherited(arguments),function(){_14._currentRowState=_14._currentRowState|_14._rowStates.EXPANDED;_14._updateStyle();def.resolve();});return def;},setSelected:function(_15){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _16=this._currentRowState;this._currentRowState=_15?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_16;this._updateStyle();if(_15){this.emit("nodeSelected",this);}},setFocusable:function(_17){this.inherited(arguments);_4.toggle(this.domNode,"epi-folderTreeNode--focused",_17);},_updateIndividualLayout:function(){this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_4.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_4.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");_4.add(this.domNode,"epi-folderTreeNode--hovered");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();_4.remove(this.domNode,"epi-folderTreeNode--hovered");},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_18){var _19=this._rowStates;switch(_18){case _19.SELECTED:case _19.ENTERED:if(this.contextMenu){_4.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_4.remove(this.iconNodeMenu,this._blockFolderMenu);}_4.remove(this.iconNode,this._blockFolderExpand);_4.remove(this.iconNode,this._blockFolderCollapse);var _1a=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_4.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_1a);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_4.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){if(this._destroyed){return;}for(var _1b in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_1b],10)>0){this._updateStyleBySingleState(this._rowStates[_1b]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_3.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_1c){if(this._editWidget){_1c=_b.encode(_1c);this._editWidget.invalidMessage=_1c||"";this._editWidget.set("state",_1c?"Error":"");this._editWidget.isValid=function(){return !_1c;};this._editWidget.validate();}}});});