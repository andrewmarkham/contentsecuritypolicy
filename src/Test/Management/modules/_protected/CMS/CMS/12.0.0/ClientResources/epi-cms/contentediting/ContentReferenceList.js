//>>built
define("epi-cms/contentediting/ContentReferenceList",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","dojo/when","dijit/_WidgetBase","dgrid/_StoreMixin","dgrid/Keyboard","dgrid/List","dgrid/Selection","dgrid/extensions/DijitRegistry","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/Responsive","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/DnD","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/WithContextMenu","put-selector/put","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferencelisteditor"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,DnD,_11,_12,put,_13){var _14=_1(_8,{refresh:function(){var _15=this;this.inherited(arguments);if(!this.store){return;}return this._trackError(function(){var _16=_15.get("queryOptions"),_17=_15.store.query(_15.query,_16);return _15.renderArray(_17,null,_16);});},renderArray:function(){var _18=this.inherited(arguments);if(_18&&_18.length===0){this.noDataNode=put(this.contentNode,"div.dgrid-no-data");this.noDataNode.innerHTML=this.noDataMessage;}this._lastCollection=null;return _18;}});return _1([_7],{listItemType:"card",store:null,query:null,_listClass:_1([_a,_e,_b,_9,_12,_c,DnD,_14,_f]),buildRendering:function(){this.inherited(arguments);this.query=this.query||{query:{},queryOptions:{}};this.profile=this.profile||_d.resolve("epi.shell.Profile");this._setupList();},startup:function(){this.inherited(arguments);this._list.startup();},_setupList:function(){_6(this.profile.getContentLanguage(),_2.hitch(this,function(_19){_11.contentLanguage=_19;}));var _1a=new this._listClass({"class":"epi-grid-height--auto epi-card-list epi-card-list--numbered",formatters:[_2.hitch(this,this._numberedCardFormatter)],commandCategory:"itemContext",deselectOnRefresh:false,store:this.store,noDataMessage:_13.nodatamessage,selectionMode:this.readOnly?"none":"extended",selectionEvents:"click,dgrid-cellfocusin",dndDisabled:this.readOnly,sort:this.query.queryOptions.sort,query:this.query.query,queryOptions:this.query.queryOptions,responsiveMap:{"epi-card-list--narrow":500},dndParams:{copyOnly:false,accept:this.allowedTypes,reject:this.restrictedTypes,alwaysCopy:false}},this.domNode);_1a.contextMenu.addProvider(this.commandSource);this.own(this._list=_1a);if(this.readOnly){this.own(_1a.on(".dgrid-row:click",this._updateReadOnlyCommands.bind(this)));return;}var _1b=this;this.own(_1a.on("dgrid-select",_2.hitch(this,this._updateCommands)),_1a.on(".dgrid-row:dblclick",_2.hitch(this,function(evt){var _1c=this._list.row(evt).data;this.emit("itemaction",{item:_1c});})),_1a.addKeyHandler(_5.ENTER,_2.hitch(this,function(evt){var _1d=this._list.row(evt).data;this.emit("itemaction",{item:_1d});})),_1a.addKeyHandler(_5.DELETE,_2.hitch(this,this._removeItems)),_3.after(_1a.dndSource,"onDropData",function(_1e,_1f,_20,_21){var _22=_1e.map(function(_23){return _23.data;});if(this.grid.dndSource===_1f){var _24=_1b.getSelectedIds();_1b.emit("itemsmoved",{ids:_24});}else{_1b.emit("itemsdropped",{items:_22});}},true),_3.before(_1a.dndSource,"delItem",_2.hitch(this,this._removeItems),true));},setSelection:function(_25){this._list.clearSelection();_25.forEach(function(_26){this._list.select(_26);},this);},getSelectedIds:function(){var ids=[];for(var _27 in this._list.selection){ids.push(_27);}return ids;},_updateReadOnlyCommands:function(){var _28={ids:this.getSelectedIds()};this._list.clearSelection();this.commandSource.updateCommandModel(_28);},_updateCommands:function(){var _29={ids:this.getSelectedIds()};this.commandSource.updateCommandModel(_29);},_numberedCardFormatter:function(_2a,_2b,_2c,_2d){var _2e=_11[this.listItemType];_4.add(_2c,"epi-card--numbered");return _2e[0](_2a,_2b,_2c,_2d);},_removeItems:function(){var _2f=this.getSelectedIds();this.emit("itemsremove",{ids:_2f});},refresh:function(){this._list.refresh();this._updateCommands();},getDndSource:function(){return this._list.dndSource;},focus:function(){var _30=this.getSelectedIds();var _31=_30[0];if(_31){var _32=this._list.row(_31);this._list.focus(_32);}else{this._list.focus();}_30.forEach(function(id){var row=this._list.row(id);this._list.select(row);},this);}});});