//>>built
define("epi-cms/_ContentContextMixin",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_8],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_3.after(this.getContentDataStore(),"notify",function(_a,id){this.itemChanged(id,_a);}.bind(this),true));},getContentDataStore:function(){if(!this.contentDataStore){var _b=_6.resolve("epi.storeregistry");this.contentDataStore=_b.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _c=new _4();_5(this.getCurrentContext(),_2.hitch(this,function(_d){if(!this._isContentContext(_d)){_c.reject({message:"Not a content data",context:_d});return;}_5(this.getContentDataStore().get(_d.id),function(_e){_c.resolve(_e);});}));return _c.promise;},contextChanged:function(_f,_10){this.inherited(arguments);if(!this._isContentContext(_f)){this._currentContentContext=null;return;}var _11=(_10&&_10.forceContextChange?_10.forceContextChange:false);if(!_11&&this._isSameAsCurrentContentContext(_f)){return;}this._currentContentContext=_f;this.contentContextChanged(_f,_10);},contextUpdated:function(ctx,_12){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_12);},contentContextChanged:function(ctx,_13){},contentContextUpdated:function(ctx,_14){},itemChanged:function(id,_15){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_16,_17){var _18=new _7(_16),_19=new _7(_17);if(this.ignoreVersionWhenComparingLinks&&_18.getType()==="epi.cms.contentdata"&&_19.getType()==="epi.cms.contentdata"&&_9.compareIgnoreVersion(_18.getId(),_19.getId())){return true;}else{if(_16===_17){return true;}}return false;}});});