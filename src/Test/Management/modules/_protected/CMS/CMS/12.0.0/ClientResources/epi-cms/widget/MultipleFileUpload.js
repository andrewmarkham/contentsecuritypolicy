//>>built
require({cache:{"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>"}});define("epi-cms/widget/MultipleFileUpload",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/form/Uploader","epi/routes","epi/shell/DialogService","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi/shell/form/uploader/HTML5"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){return _2([_8,_9,_a,_7],{res:_12,_isCompleted:true,templateString:_11,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _e();},upload:function(_13){var _14=this,_15=_14.uploaderInput,_16=_14._getUploadSettings();if(!_13||_13.length===0){return;}_6(_14.model.upload(_13),function(_17){_6(_14._confirm(_17),function(_18){_14._resetUploader();if(!(_18 instanceof Array)||_18.length===0){_14._onUploadComplete(_18);return;}_14._fileListModel.set("uploadFiles",_18);_15._files=_18;_15.upload(_16);});});},close:function(){var _19=this,_1a=_19.uploaderInput._files,_1b=function(_1c){_19.emit("close",_1c);_19.set("disableToolbar",false);};if(_19._isCompleted||!_1a||_1a.length<=0){_1b(false);}else{_d.alert(_12.confirmdialog.description).then(function(){_1b(true);});}},_setBreadcrumbAttr:function(_1d){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_4.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_1e=_1d?_1d.length:0;if(_1e>0){for(i;i<_1e-1;i++){this.breadcrumbBar._createItem(_1d[i],true);}this.breadcrumbBar._createItem(_1d[_1e-1],false);}},_setDisableToolbarAttr:function(_1f){this.uploaderInput.set("disabled",_1f);!_1f&&this.uploaderInput.set("tabindex",0);},_setupUploader:function(){var _20=this;this.uploaderInput.uploadUrl=_c.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});this.own(_5.before(this.uploaderInput,"onChange",function(_21){_20._isCompleted=false;_20.set("disableToolbar",true);return [_20._getUploadSettings()];}),this.uploaderInput.on("error",function(){_20._fileListModel.error();_20._onUploadComplete();}));},_getUploadSettings:function(){return {uploadDirectory:this.get("uploadDirectory"),createAsLocalAsset:this.get("createAsLocalAsset")};},_setupFileList:function(){var _22=this,_23=this.uploaderInput;_22._fileListModel=new _10();_22.fileList.set("model",_22._fileListModel);this.own(_23.on("begin",function(_24){if(_24&&_24.length>0){_22._fileListModel.set("showProgressBar",true);}}),_23.on("progress",function(_25){_22._fileListModel.set("progress",_25);}),_23.on("complete",_3.hitch(_22,_22._onUploadComplete)),_5.after(_23,"reset",_3.hitch(_22,_22._fileListModel.clear)),_5.around(_23,"onChange",function(_26){return function(_27){var _28=_23._files;return _6(_22.model.upload(_28),function(_29){return _6(_22._confirm(_29),function(_2a){_2a=_f.getFileArray(_2a);if(!(_2a instanceof Array)||_2a.length===0){_22._resetUploader();return _26.apply(_23,[_27]);}_22._fileListModel.set("uploadFiles",_2a);_23._files=_2a;_23.upload(_22._getUploadSettings());return _26.apply(_23,[_27]);});});};}));},_confirm:function(_2b){return _2b.showConfirmation===true?this._confirmationDialog.showConfirmation(_2b.existingContents,_2b.uploadingFiles,_2b.newFiles):_2b.uploadingFiles;},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){this._fileListModel.set("showProgressBar",false);this.uploaderInput.reset();this.set("disableToolbar",false);},_onUploadComplete:function(evt){this._isCompleted=true;var _2c=_f.getFileArray(evt);this._fileListModel.update(_2c);this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",this._fileListModel.uploadFiles||_2c);}});});