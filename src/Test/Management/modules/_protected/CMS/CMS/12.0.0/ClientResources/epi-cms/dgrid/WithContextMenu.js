//>>built
define("epi-cms/dgrid/WithContextMenu",["dojo/_base/declare","dojo/_base/event","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/query","dgrid/extensions/DijitRegistry","epi/shell/DestroyableByKey","epi/shell/widget/ContextMenu","epi-cms/extension/events"],function(_1,_2,_3,_4,on,_5,_6,_7,_8,_9){return _1([_7,_6],{contextMenu:null,commandCategory:"context",stopPropagation:false,_contextMenuClass:"epi-iconContextMenu",postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _8({category:this.commandCategory,popupParent:this});this.own(this.contextMenu,this.on("."+this._contextMenuClass+":click",this._contextMouseHandler.bind(this)),this.on(on.selector(".dgrid-row",_9.keys.shiftf10),this._contextKeyHandler.bind(this)));},startup:function(){this.inherited(arguments);this.contextMenu.startup();},onContextMenuClick:function(e){if(this.selection){this.select(e.target);}on.emit(e.target,"dgrid-contextmenu",{bubbles:true});this.contextMenu.scheduleOpen(this.domNode,null,{x:e.pageX,y:e.pageY});},_extendedSelectionHandler:function(e,_a){var _b=new RegExp("\\b"+this._contextMenuClass+"\\b");if(_b.test(e.target.className)&&this.isSelected(_a)){return;}this.inherited(arguments);},_isNodeVisible:function(_c){if(!_c){return false;}var _d=_4.get(_c);return _d.display!=="none"&&_d.visibility!=="hidden";},_contextMouseHandler:function(e){if(this.stopPropagation){e.stopImmediatePropagation();e.stopPropagation();}this.onContextMenuClick(e);},_contextKeyHandler:function(e){var _e=_5("."+this._contextMenuClass,e.target)[0],_f;if(!this._isNodeVisible(_e)){return;}e.stopPropagation();e.preventDefault();_f=_3.position(_e);this.onContextMenuClick({target:_e,pageX:_f.x,pageY:_f.y});}});});