//>>built
define("epi-cms/contentediting/ExpirationNotification",["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1([_2],{order:60,postscript:function(){this.inherited(arguments);this._notificationPeriod=_6.expirationNotificationPeriod;this._setupCommands();},_valueSetter:function(_9){var _a=_9.contentData.properties.iversionable_expire;this._updateNotification(_a);},_updateNotification:function(_b){var _c=_4.serverTime();var _d=_b?_b.stopPublish:null,_e=new Date(_d);var _f=null;if(_d&&_4.isDateValid(_e)){if(new Date(_c.getTime()+this._notificationPeriod*1000)>_e){_f=_e<_c?_8.expired:_3.substitute(_7.expiretimetext,[_4.timeToGo(_e)]);}}if(!_f){this.set("notification",null);}else{this.set("notification",{content:_f,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_5.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var _10=this;_10._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(_11,_12,_13){if(_10._viewModelValueHandler){_10._viewModelValueHandler.unwatch();}_10._viewModelValueHandler=_13.watch("value",function(_14,_15,_16){_10._updateNotification(_16);});});}});});