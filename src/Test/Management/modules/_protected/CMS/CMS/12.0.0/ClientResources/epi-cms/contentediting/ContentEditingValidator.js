//>>built
define("epi-cms/contentediting/ContentEditingValidator",["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _3([_8],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{none:0,info:1,warn:2,error:3},validationSource:{server:1,client:2},_errorLevels:{},constructor:function(_a){_3.safeMixin(this,_a);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _b=this.severity[p];this._errorLevels[_b]=p;}this.messageService=this.messageService||_9.resolve("epi.shell.MessageService");this._store=new _7({idAttribute:"id",data:[]});},setContextId:function(_c){var _d=this.contextId;this.contextId=_c;var _e=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_d});_e.forEach(_5.hitch(this,function(_f){_f.contextId=this.contextId;this.messageService.put(_f);}));},clearPropertyErrors:function(_10,_11){if(!_10){return;}this._clearErrors(_10,_11);},setPropertyErrors:function(_12,_13,_14){if(!_12){return;}this._setErrors(_13,_12,_14);},clearGlobalErrors:function(_15){this._clearErrors(null,_15);},clearErrorsBySource:function(_16){this._clearErrors(undefined,_16);},setGlobalErrors:function(_17,_18){this._setErrors(_17,null,_18);},_clearErrors:function(_19,_1a){var _1b;if(_19){_1b={propertyName:_19};}else{if(_19===null){_1b={global:true};}else{_1b={};}}if(_1a){_1b.source=_1a;}var _1c=this._store.query(_1b);_1c.forEach(_5.hitch(this,function(_1d){this.messageService.remove({id:_1d.messageId});this._store.remove(_1d.id);}));this._updateFlags();},_setErrors:function(_1e,_1f,_20){this._clearErrors(_1f,_20);_2.forEach(_1e,function(_21){this._putStoreItem(_21,_1f,_20);},this);this._updateFlags();},_putStoreItem:function(_22,_23,_24){var _25="";if(this._errorLevels[_22.severity]){_25=this._errorLevels[_22.severity];}var _26=this.messageService.put(_25,_22.errorMessage,this.contextTypeName,this.contextId);var _27={id:this._storeId++,item:_22,severity:_22.severity,messageId:_26};if(_23){_27.propertyName=_23;}else{_27.global=true;}if(_24!==undefined){_27.source=_24;}return this._store.put(_27);},_updateFlags:function(){var _28=this._store.query({severity:this.severity.error});var _29=this._store.query({severity:this.severity.warn});var _2a=_28.length===0&&_29.length===0;var _2b=_28.length>0;this.set("isValid",_2a);this.set("hasErrors",_2b);},validate:function(){var _2c=this.severity.error,_2d=new _4();_4.when(this._validate(_2c),function(_2e){if(_2e){_6.publish("/epi/cms/action/showerror");}_2d.resolve(_2e);},function(){_6.publish("/epi/cms/action/showerror");_2d.reject();});return _2d;},_validate:function(_2f){var _30=new _4();if(!this._isBlocking){_4.when(this._store.query({severity:_2f}),_5.hitch(this,function(_31){var _32=_2.filter(_31,function(_33){return _33.source===this.validationSource.client;},this);var _34=_32.length>0;var _35=_31.length>_32.length;if(_34){_30.reject();}else{_30.resolve(_35);}}));}return _30;}});});