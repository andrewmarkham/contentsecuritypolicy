//>>built
define("epi-cms/command/NewContent",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _2([_9],{contentType:null,createAsLocalAsset:false,postscript:function(){this.inherited(arguments);var _c=this.contentType;this.label=this.label||_a.getResourceValue(_c,"create");this.tooltip=this.tooltip||_a.getResourceValue(_c,"createdescription");this.iconClass=this.iconClass||_a.getValue(_c,"commandIconClass");if(!this.store){var _d=_8.resolve("epi.storeregistry");this.store=_d.get("epi.cms.contenttype");}},_execute:function(){_5.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,view:_a.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}this.set("canExecute",this._canExecute());var _e=this.model;if(!_e){this.set("isAvailable",false);return;}_6(this._getContentType(_e),_3.hitch(this,function(_f){if(!_f){this.set("isAvailable",false);return;}_6(this._checkAvailability(_f.availableContentTypes),_3.hitch(this,function(_10){this.set("isAvailable",_10);}));}));},_canExecute:function(){var _11=this.model,_12=_b.action.Create,_13=_b.providerCapabilities.Create,_14=_11&&!(_11.isWastebasket||_11.isDeleted)&&_b.hasLanguageAccess(_11)&&_b.isActionAvailable(_11,_12,_13,true);return !!_14;},_getContentType:function(_15){if(!_15){return null;}return this.store.get(_15.contentTypeID);},_checkAvailability:function(_16){if(_16.length===0){return false;}var _17=new _4();var _18=_1.map(_16,_3.hitch(this,function(_19){return this.store.get(_19);}));_6(_7(_18),_3.hitch(this,function(_1a){var _1b=_1.some(_1a,_3.hitch(this,function(_1c){return _a.isBaseTypeIdentifier(_1c.typeIdentifier,this.contentType);}));_17.resolve(_1b);}));return _17;}});});