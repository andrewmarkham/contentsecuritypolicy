//>>built
define("epi-cms/asset/command/NewFolder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _2([_6,_7],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _b=this.typeIdentifier;this._defaultName=_8.getResourceValue(_b,"newitemdefaultname");var _c=_8.getResourceValue(_b,"create");this.set("label",_c);this.set("tooltip",_c);},_execute:function(){var _d=this,_e=_d._getSingleSelectionData(),_f=(new _9(_e.contentLink)).createVersionUnspecificReference().toString(),_10=_d.createAsLocalAsset;var _11=function(_12){_d.model.getChildren(_12,function(_13){_5(_d.model.add({parentLink:_f,name:_d._getUniqueFolderName(_13,_d._defaultName),contentTypeIdentifier:_d.typeIdentifier,createAsLocalAsset:_10},_d.onRefreshSelection),function(_14){if(_14.parentLink!==_f){_4.publish("/epi/cms/action/createlocalasset");}});});};if(_10){_5(_d.model.store.refresh(_f),function(_15){_5(_d.model.store.get(_15.assetsFolderLink),_11);});}else{_11(_e);}},_onModelChange:function(){var _16=this._getSingleSelectionData(),_17=_a.action.Create,_18=_a.providerCapabilities.Create,_19=!!this.model&&!!_16&&_a.isActionAvailable(_16,_17,_18,true),_1a=_19&&_8.isBaseTypeIdentifier(_16.typeIdentifier,this.typeIdentifier);this.set("isAvailable",_1a);this.set("canExecute",_19);},_getUniqueFolderName:function(arr,_1b){var _1c=function(_1d){var _1e=_1d>0?_3.replace(_1b+" {0}",[_1d]):_1b;if(_1d>1000){return _1e;}var _1f=_1.some(arr,function(_20){return _3.trim(_20.name).toLowerCase()===_3.trim(_1e).toLowerCase();});if(_1f){_1d=_1d+1;return _1c(_1d);}return _1e;};return _1c(0);}});});