//>>built
define("epi/shell/widget/FormContainer",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/has","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Form","epi/epi","require","epi/shell/widget/WidgetFactory","epi/shell/MetadataTransformer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _1([_8,_9,_a],{templateString:"<div class=\"epi-form-container\">                            <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\">                            </div>                         </div>",value:null,metadata:null,propertyFilter:null,defaultContainerWidget:"epi/shell/layout/SimpleContainer",useDefaultValue:null,readOnly:false,doLayout:true,_widgetMap:null,_uiSetUp:false,_aspectHandles:null,postMixInProperties:function(){this.inherited(arguments);this._widgetMap={};this._aspectHandles=[];},startup:function(){if(this._started){return;}this.inherited(arguments);this._setupUI();},destroy:function(_10){_2.forEach(this._aspectHandles,function(_11){_11.remove();});this._aspectHandles=null;if(this.containerLayout){this.containerLayout.destroyRecursive(_10);this.containerLayout=null;}this.inherited(arguments);},_getValueAttr:function(){return this._formCreated?this.form.get("value"):this.value;},_setValueAttr:function(_12){if(this._formCreated){if(_12){this.form.set("value",_12);}else{this.form.reset();}}this._set("value",_12);},_setMetadataAttr:function(_13){this._set("metadata",_13);},_getUseDefaultValueAttr:function(){if(this.useDefaultValue===null){return !this.value;}return this.useDefaultValue;},onGroupCreated:function(_14,_15){},onChange:function(_16){},onFieldCreated:function(_17,_18){},_onFormCreated:function(_19){if(_c.isEmpty(this.get("value"))){this._onChange();}this.onFormCreated(_19);},onFormCreated:function(_1a){},_setupUI:function(){var _1b=new _e();var _1c=this.metadataTransformer||new _f({propertyFilter:this.propertyFilter});_7(this.metadata,_3.hitch(this,function(_1d){if(false){var _1e=_d.timedGroup("FormContainer::_setupUI "+arguments.callee.caller.nom);}var _1f=this.get("useDefaultValue");var _20=_1c.toComponentDefinitions(_1d,"",_1f,this.readOnly);var _21=_1d.layoutType||this.defaultContainerWidget;require([_21],_3.hitch(this,function(_22){var _23=[],_24=[];this.containerLayout=new _22();_23.push(this.containerLayout);this.connect(_1b,"onWidgetCreated",function(_25,_26){var _27=_23[_23.length-1];var _28=_24.length?_24[_24.length-1]:null;this._widgetMap[_25.id]={parent:_27,group:_28};this.own(this.watch("readOnly",_3.hitch(this,function(_29,_2a,_2b){_25.set("readOnly",_2b);})));if(_26.settings._type==="field"){_25.set("editMode","createcontent");this.connect(_25,"onChange","_onChange");this._aspectHandles.push(_5.before(_25,"focus",_3.hitch(this,function(){this._beforeSetFocus(_25);})));this.onFieldCreated(_26.settings.name,_25);}else{if(_26.settings._type==="group"){_24.push(_25);this.onGroupCreated(_26.settings.name,_25,_28);}else{if(_26.settings._type==="parent"){_23.push(_25);}}}});this.connect(_1b,"onWidgetHierarchyCreated",function(_2c,_2d){if(_2d.settings._type==="group"){_24.pop();}else{if(_2d.settings._type==="parent"){_23.pop();}}});_7(_1b.createWidgets(this.containerLayout,_20,false),_3.hitch(this,function(_2e){if(this._destroyed){if(false){_1e.end();}return;}this.containerLayout.placeAt(this.form.domNode);this._formCreated=true;this.form.connectChildren();if(this.value!==null){this.set("value",this.value);}this.layout();this._uiSetUp=true;this._onFormCreated(this);_1b=null;_23=null;_24=null;if(false){_1e.end();}}));this.own(this.form.watch("state",_3.hitch(this,function(_2f,_30,_31){this.set("state",_31);})));}));}));},_onChange:function(){if(!this._uiSetUp){return;}var _32=this.form.get("value");if(!_c.areEqual(this.value,_32)){this.value=_32;this.onChange(_32);}},focus:function(){},layout:function(){if(!this._started){return;}var _33=this.containerLayout;if(_33&&_33.resize){var _34=this._containerContentBox||this._contentBox;_33.resize(this.doLayout&&_34&&_34.w&&_34.h?_34:null);}},validate:function(){return this._uiSetUp&&this.form.validate();},isValid:function(){return this.validate();},_beforeSetFocus:function(_35){if(this._widgetMap[_35.id]){var _36=this._widgetMap[_35.id].parent;var _37=this._widgetMap[_35.id].group;this._beforeSetFocus(_36);if(_36.selectChild){_36.selectChild(_37);}}}});});