//>>built
define("epi/dnd/Source",["dojo"],function(_1){return _1.declare(null,{avatarId:"epi_dnd_avatar",_startDragPos:null,_onDragHandle:null,_onDragEndHandle:null,buildAvatar:function(_2){return _1.clone(_2);},buildDragImage:function(_3,_4){},addDraggableNode:function(_5,_6,_7){_5.draggable=true;_1.connect(_5,"ondragstart",_1.hitch(this,function(_8){var _9={type:_6,data:_7};_8.dataTransfer.setData("Text",_1.toJson(_9));this.buildDragImage(_8,_5);_1.publish("/EPi/DnD/DragStart",[{type:_6}]);if(_1.isIE<=9){this._createAvatar(_5);}return true;}));_1.connect(_5,"ondragend",_1.hitch(this,function(_a){_1.publish("/EPi/DnD/DragEnd",[{type:_6}]);}));},_createAvatar:function(_b){var _c=this._startDragPos=_1.position(_b);var _d=_1.contentBox(_b);var _e=this.buildAvatar(_b);_e.id=this.avatarId;_1.place(_e,_1.body());_1.style(_e,"position","absolute");_1.style(_e,"display","block");_1.style(_e,"width",_d.w+"px");_1.style(_e,"height",_d.h+"px");_1.style(_e,"left",_c.x+"px");_1.style(_e,"top",_c.y+"px");_1.style(_e,"zIndex",1200);this._onDragHandle=_1.connect(_1.body(),"ondrag",_1.hitch(this,this._moveAvatar));this._onDragEndHandle=_1.connect(_1.body(),"ondragend",_1.hitch(this,this._destroyAvatar));},_moveAvatar:function(_f){var _10=_1.byId(this.avatarId);if(!_10){return;}var pos={x:_f.clientX,y:_f.clientY};_1.style(_10,"left",pos.x+"px");_1.style(_10,"top",(pos.y+1)+"px");},_destroyAvatar:function(evt){var _11=_1.byId(this.avatarId);if(!_11){return;}_1.destroy(_11);_1.disconnect(this._onDragHandle);_1.disconnect(this._onDragEndHandle);}});});