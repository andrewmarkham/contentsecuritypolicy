//>>built
define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_1,_2,_3,_4,_5){var _6=_1(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof _4;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _7;_2.forEach(this.subRows,function(_8){_2.forEach(_8,function(_9){_7=[];_2.forEach(_6.shorthands,function(_a){var _b=_9[_a],_c=_6.formatters[_a];if(_b){if(_c){_7.push(_c.isFactory?_c.handler(_b):_c.handler);}else{throw new Error("Formatter with key "+_a+" not found");}}});if(_9.formatters){this._findFormatters(_9.formatters,_7);}if(_7.length>0){_9=_5(_9,_7);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(_d,_e,_f){return _d;}];}}},renderRow:function(_10,_11){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_11]),_12=this.field?_10[this.field]:_10,_13=this._resolvedFormatters,i=-1;function _14(_15){var _16=_13[i],_17;if(_16){row.innerHTML=_15;_12=_15;}i++;if(_13.length>i){_16=_13[i];_17=_16(_12,_10,row);_3(_17,_14);}};if(_13.length>0){_14();}return row;},_findFormatters:function(_18,_19){_19=_19||[];_2.forEach(_18,function(_1a){var _1b=typeof _1a,_1c,_1d;if(_1b==="string"){_1c=_6.formatters[_1a];if(_1c){_1d=_1c.isFactory?_1c.handler():_1c.handler;_1d.allParameters=_1c.allParameters;}}else{if(_1b==="function"){_1d=_1a;}}if(_1d){_19.push(_1d);}else{throw new Error("Formatter with key "+_1a+"not found");}});return _19;}});_6.formatters={};_6.shorthands=[];_6.addFormatter=function(_1e,_1f,_20,_21){_6.formatters[_1e]={handler:_1f,isFactory:!!_20};if(_21){_6.shorthands.push(_1e);}};return _6;});