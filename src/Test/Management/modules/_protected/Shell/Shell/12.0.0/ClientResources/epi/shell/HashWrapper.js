//>>built
define("epi/shell/HashWrapper",["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/cookie","dojo/io-query","dojo/hash","dojo/Stateful","epi/epi"],function(_1,_2,_3,_4,io,_5,_6,_7){return _2([_6],{encodeEnabled:false,_requestContext:true,_hashChanged:true,constructor:function(_8){if(_8){this.encodeEnabled=_8.encodeEnabled;}this._hash=this._hash||_5;this._cookie=this._cookie||_4;_1.subscribe("/dojo/hashchange",this,"_onHashChanged");},getHash:function(){var _9=this._hash();if(!_9){var _a=this._cookie("epihash");if(_a){_9=this._hash(_a);}this._cookie("epihash",null,{expires:-1,path:"/"});}return io.queryToObject(decodeURIComponent(_9));},setHash:function(_b){this._hash(this.encodeEnabled?encodeURIComponent(decodeURIComponent(io.objectToQuery(_b))):decodeURIComponent(io.objectToQuery(_b)));},hashEmpty:function(){return _7.isEmpty(this.getHash());},onHashChanged:function(_c){},_hashAreEqual:function(_d,_e){if(!_d&&!_e){return true;}if(_d&&_e){return (_d.context===_e.context);}return false;},onContextChange:function(_f,_10){this._onContextChange(_f,_10);},extractHash:function(ctx,_11){var _12=this.getHash();var _13=this._getNewHash(ctx);var _14=this.hashEmpty()?_13:_3.mixin(_12,_13);return this.encodeEnabled?encodeURIComponent(decodeURIComponent(io.objectToQuery(_14))):decodeURIComponent(io.objectToQuery(_14));},_onContextChange:function(ctx,_15){var _16=this.getHash();var _17=this._getNewHash(ctx);if(!this._hashAreEqual(_16,_17)){if(!_15||_15.sender!==this){this._requestContext=false;this._hash(this.extractHash(ctx,_15));}this.onHashChanged(ctx);}else{if(this._hashChanged){this.onHashChanged(ctx);}}this._hashChanged=false;},_getNewHash:function(ctx){return {context:ctx.requestedUri||ctx.versionAgnosticUri||ctx.uri};},_onHashChanged:function(_18){if(this._requestContext){this._hashChanged=true;var _19=io.queryToObject(decodeURIComponent(_18));if(_19&&_19.context){var _1a={uri:_19.context};_1.publish("/epi/shell/context/request",[_1a,{sender:this}]);}}this._requestContext=true;}});});